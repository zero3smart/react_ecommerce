<!DOCTYPE html>
<html>
<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120529562-1"></script>
	<script>
		 window.dataLayer = window.dataLayer || [];
    	function gtag(){dataLayer.push(arguments);}
	    gtag('js', new Date());

	    gtag('config', 'UA-120529562-1');
	</script>

    <title>Search By Product</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
 
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
    <script src="js/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-3.4.2.js"></script>
    <script src="vf_common.js"></script> 

<!--
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-3.4.2.js"></script> -->
    <style>
    .btn-buynow {
        border: none;
        background-color: #101010;
        min-width: 200px;
        max-width: 400px;
        <!--padding: 14px 28px;
        font-size: 16px;
        cursor: pointer;
        display: inline-block;
        color: #f0f0f0; -->
    }
    .vcenter {
        display: inline-block;
        vertical-align: middle;
        float: none;
    }
    #vert-scroll {
    height:100%;
    text-align: left;
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
    overflow-y: scroll;
    }
    .nopadding {
    {
        padding: 0 !important;
        margin: 0 !important;
    }
    }
    .carousel .item{
        min-height: 200px; /* Prevent carousel from being distorted if for some reason image doesn't load */
    }
    .carousel .item img{
        margin: 0 auto; /* Align slide image horizontally center */
    }
    .img-thumbnail {
        border: 0 none;
        box-shadow: none;
    }
    @media screen and (min-width: 600px) {
        h4 { font-size: 3.5vw; }
        h5 { font-size: 3.0vw; }
        h6 { font-size: 2.5vw; }
    }
    </style>
</head>
<body>
    <div id="main" class="container-fluid" width="100%">
        <!-- <div class="navbar-inner">
            <h3>Search By Product</h3>
        </div> -->
         <div style="margin-top:20px"></div>
         <div class="row">
            <div data-bind="foreach: current_products">
                <div class="col-xs-6 col-sm-6 col-md-3"> 
                    <!-- <img data-bind="attr: {src: front_img}" class="img-thumbnail" style="width:100%"/>  -->
                    <div id="img-carousel" class="carousel slide" data-ride="carousel">
                        <ol class="carousel-indicators">
                            <li data-target="#img-carousel" data-slide-to="0" class="active"></li>
                            <!-- ko foreach: extra_imgs -->
                            <li data-target="#img-carousel" data-bind="{data-slide-to: $index+1}"></li>
                            <!-- /ko -->
                        </ol>
                        <div class="carousel-inner">
                            <div class="item active">
                                <img data-bind="attr: {src: front_img, alt: front_img}" style="width:100%"/>
                            </div>
                            <!-- ko foreach: extra_imgs -->
                            <div class="item">
                                <img data-bind="attr: {src: $data, alt: $data}" style="width:100%"/>
                            </div>
                            <!-- /ko -->
                        </div>
                        <!-- Left and right controls -->
                        <a class="left carousel-control" href="#img-carousel" data-slide="prev" style="background:none !important">
                            <span class="glyphicon glyphicon-chevron-left"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#img-carousel" data-slide="next" style="background:none !important">
                            <span class="glyphicon glyphicon-chevron-right"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>	
                </div>
                <div class="col-xs-6 col-sm-6 col-md-6"> 
                    <h4 data-bind="text: name"></h4>
                    <h5 data-bind="text: brand"></h5>
                    <div style="margin-top:20px"></div>
                    <h5 data-bind="text: price"></h5>
                    <div style="margin-top:20px"></div>
                    <h6 data-bind="text: description"></h6>
                </div>
                <div class="col-xs-12 col-sm-6 col-md-6"> 
                <div style="margin-top:20px"></div>
                <a role="button" class="btn btn-lg btn-block btn-buynow" data-bind="attr: {href: buy_link}"
                    target="_blank">Buy Now</a>
                </div>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-12" >
                <div class="row" align="center" data-bind="foreach: similar_products">
                    <a data-bind="attr: {href: link}">
                        <!--<img data-bind="attr: {src: front_img}" class="img-thumbnail img-responsive" style="max-width:32%"/> -->
                        <img data-bind="attr: {src: front_img}" class="img-thumbnail img-responsive" style="max-width:30%" />
                    </a>
                </div>
            </div>
         </div>
   </div>
    <script type="text/javascript">
        function Product(data) {
            var self = this;
            self.product_id = data.product_id;
            self.front_img = rest_server_url + "imgs/ns_woman_top/"+data.front_img;
            self.details = data.extra_info;
            self.name = data.name
            self.description = data.description
            self.brand = data.brand
            self.price = "$"+data.price
            self.link = "search_by_product.html?pid="+data.product_id
            self.buy_link = data.src_url
            self.extra_imgs = []
			for (i in data.extra_imgs)
			{
				self.extra_imgs.push(rest_server_url + "imgs/ns_woman_top/"+data.extra_imgs[i])
			}

			//if (self.extra_imgs.length)
            //	console.log(self.front_img, self.extra_imgs)
            //console.log('Creating Product', data, self.product_id, self.front_img);
        }
        function getSearchParameters() {
            var prmstr = window.location.search.substr(1);
            return prmstr != null && prmstr != "" ? transformToAssocArray(prmstr) : {};
        }

        function transformToAssocArray( prmstr ) {
            var params = {};
            var prmarr = prmstr.split("&");
            for ( var i = 0; i < prmarr.length; i++) {
                var tmparr = prmarr[i].split("=");
                params[tmparr[0]] = tmparr[1];
            }
            return params;
        }
        function getCurrentPid() {
            var params = getSearchParameters();
            var pid = params['pid'];
            return pid;
        }
        function getCurrentProduct() {
            var self = this;
            http_req = rest_server_url + "products/woman_top/"+getCurrentPid();
            console.log(http_req);
            $.getJSON(http_req, function(allData) {
                mappedProducts = $.map(allData['products'], function(item) { return new Product(item) });
                self.current_products(mappedProducts);
            });
        }

        function getSimilarProducts() {
            var self = this;
            http_req = rest_server_url + "products/woman_top?";
            http_req += "page=0";
            http_req += "&selected_product_id="+getCurrentPid();
            http_req += "&cnt_per_page=48";
            console.log(http_req);
            $.getJSON(http_req, function(allData) {
                mappedProducts = $.map(allData['products'], function(item) { return new Product(item) });
                self.similar_products(mappedProducts);
            });
        }

        function PropertiesViewModel() {
            var self = this;
            self.product_desc = ko.observable("Product Description");

            //self.request_str = ko.computed(getHttpReqStr, self);
            self.current_products = ko.observableArray([]);
            self.similar_products = ko.observableArray([]);
            self.current_products_req = ko.computed(getCurrentProduct, self);
            self.similar_products_req = ko.computed(getSimilarProducts, self);
        }
        ko.applyBindings( new PropertiesViewModel());
    </script>
</body>
</html>

